#!/usr/bin/env sh
node scripts/check-tsx-tests.mjs
check_status=$?
if [ $check_status -ne 0 ]; then
  exit $check_status
fi

# Capture test output and print it only if tests fail, so the first visible line is the failure reason.
tmpfile=".git/.pre-commit-npm-test.log"
npm test --silent >"$tmpfile" 2>&1
status=$?

if [ $status -ne 0 ]; then
  # Print to stdout (and not only stderr) so VS Code surfaces it more reliably.
  echo "[pre-commit] Tests failed â€” commit blocked."
  cat "$tmpfile"
  rm -f "$tmpfile"
  exit $status
fi

rm -f "$tmpfile"
